#!/bin/bash

TEMP_FILE=$(mktemp /tmp/puush_screenshot_XXXXXX.png)
SCREENSHOT_DIR="$HOME/Pictures/Screenshots"

# Take screenshot and save to temp file
spectacle -brn -o "$TEMP_FILE"

# Check if file was created AND has content (not empty/tiny)
if [ -f "$TEMP_FILE" ] && [ -s "$TEMP_FILE" ]; then
    # Check if file size is reasonable (more than 1KB)
    FILE_SIZE=$(stat -c%s "$TEMP_FILE" 2>/dev/null || stat -f%z "$TEMP_FILE" 2>/dev/null)
    
    if [ "$FILE_SIZE" -gt 1024 ]; then
        # Create screenshot directory if it doesn't exist
        mkdir -p "$SCREENSHOT_DIR"
        
        # Generate filename with timestamp
        FILENAME="Screenshot_$(date +%Y%m%d_%H%M%S).png"
        SAVED_FILE="$SCREENSHOT_DIR/$FILENAME"
        
        # Copy to Screenshots folder
        cp "$TEMP_FILE" "$SAVED_FILE"
        
        # Upload the file
        ~/.local/bin/puush "$TEMP_FILE"
    fi
    
    rm -f "$TEMP_FILE"
else
    rm -f "$TEMP_FILE"
fi
